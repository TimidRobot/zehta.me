<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="default-src 'self'; connect-src 'self' stats.zehta.me; font-src 'self' cdnjs.cloudflare.com; img-src 'self' licensebuttons.net www.gravatar.com; script-src 'self' stats.zehta.me; style-src 'self' cdnjs.cloudflare.com;" http-equiv="Content-Security-Policy"/><title>Troubleshooting collectd / statsd / Graphite - Timid Robot</title><meta content="Timid Robot Zehta" name="author"/><link href="/static/layout.css" integrity="sha512-rorP8qAZ973h10zwAm48StvvcfOMbJk7XQM0pOxxOsn73evY/105dw5e4GlE99VdrX0j6MTtVlR1bpCfmbNlsg==" rel="stylesheet"/><link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css" integrity="sha512-8Vtie9oRR62i7vkmVUISvuwOeipGv8Jd+Sur/ORKDD5JiLgTGeBSkI3ISOhc730VGvA5VVQPwKIKlmi+zMZ71w==" referrerpolicy="no-referrer" rel="stylesheet"/><link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css" integrity="sha512-bSncow0ApIhONbz+pNI52n0trz5fMWbgteHsonaPk42JbunIeM9ee+zTYAUP1eLPky5wP0XZ7MSLAPxKkwnlzw==" referrerpolicy="no-referrer" rel="stylesheet"/><link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css" integrity="sha512-6/gTF62BJ06BajySRzTm7i8N2ZZ6StspU9uVWDdoBiuuNu5rs1a8VwiJ7skCz2BcvhpipLKfFerXkuzs+npeKA==" referrerpolicy="no-referrer" rel="stylesheet"/><link href="/static/custom.css" integrity="sha512-StKCgZsirJcM+/mNn9aRCd8XW25qf0LbDkfjOCqEWM4QHbsTzf7p6RjqklHrq2hDldBVlz0zCpUh8XoAp3hYLg==" rel="stylesheet"/><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/><link href="/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png"/><meta content="Timid Robot's website" property="og:site_name"/><meta content="https://zehta.me/" property="og:url"/><meta content="Blog" property="og:title"/><meta content="website" property="og:type"/><meta content="https://zehta.me/favicon-590x310.png" property="og:image"/><meta content="590" property="og:image:width"/><meta content="310" property="og:image:height"/><meta content="image/png" property="og:image:type"/><meta content="logo" property="og:image:alt"/></head><body><nav class="container"><div class="row"><div class="three columns title"><a href="/">Timid Robot</a></div><div class="nine columns navi"><div class="navgroup"><div class="linkinactive"><a class="linkinactive" href="/about/"><i class="fas fa-address-card"></i> About</a></div><div class="linkinactive"><a class="linkinactive" href="/resume/"><i class="fas fa-laptop-code"></i> Résumé</a></div></div><div class="navgroup"><div class="linkinactive"><a class="linkinactive" href="/tags/"><i class="fas fa-tags"></i> Tags</a></div><div class="linkactive"><a class="linkactive" href="/"><i class="fas fa-newspaper"></i> Blog</a></div></div></div></div></nav><main class="container page"><div class="row"><div class="blog-post"><h1>Troubleshooting collectd / statsd / Graphite</h1><div class="meta">2014 Mar 31, Timid Robot Zehta</div><p>Troubleshooting <a href="http://graphite.readthedocs.org/en/latest/">Graphite</a> can be a bother. Determining where a problem lies requires verification of the data at all of the points of communication. The best tool I've found for this is ngrep:</p><div class="hll"><pre><span></span>sudo<span class="w"> </span>ngrep<span class="w"> </span>-lqd<span class="w"> </span>any<span class="w"> </span>ping<span class="w"> </span>tcp<span class="w"> </span>dst<span class="w"> </span>port<span class="w"> </span><span class="m">2003</span>
</pre></div><p>The following complex command finds ping metrics submitted over TCP to Graphite and highlights them using grep:</p><div class="hll"><pre><span></span><span class="nv">match</span><span class="o">=</span><span class="s1">'ping'</span><span class="p">;</span><span class="w"> </span>sudo<span class="w"> </span>ngrep<span class="w"> </span>-lqd<span class="w"> </span>any<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">match</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span>tcp<span class="w"> </span>dst<span class="w"> </span>port<span class="w"> </span><span class="m">2003</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span>--line-buffered<span class="w"> </span>--color<span class="o">=</span>tty<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">match</span><span class="si">}</span><span class="s2">"</span>
</pre></div><p>Changing the protocol and port allows easy inspection of metrics sent to a statsd listener, from carbon-aggregator to carbon-cache, etc.</p><p>See the man page for more information:</p><ul><li><a href="http://manpages.ubuntu.com/manpages/precise/en/man8/ngrep.8.html">man 8 ngrep</a></li></ul><div><h2>Tags</h2><ul><li><a href="/tags/2014//"><i class="fas fa-tag"></i> 2014</a></li><li><a href="/tags/linux//"><i class="fas fa-tag"></i> Linux</a></li><li><a href="/tags/sysadmin//"><i class="fas fa-tag"></i> System administration</a></li><li><a href="/tags/troubleshooting//"><i class="fas fa-tag"></i> Troubleshooting</a></li></ul></div></div><hr class="copyright"/><p class="copyright"><a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license" title="CC BY-SA 4.0 (license button)"><img alt="CC BY-SA 4.0 license button" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png#floatleft"/></a> Copyright © 2014 Timid Robot Zehta. This work is licensed under a <strong><a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license" title="Creative Commons Attribution-ShareAlike 4.0 International License">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</strong></p></div></main><nav class="container footer"><div class="post-prev"><a href="/2014/04/empire-dice/" title="Previous post: Star Wars: Edge of the Empire Dice Probabilities"><i class="fas fa-angle-left"></i> Star Wars: Edge of the Empi...</a></div><div class="post-next"><a href="/2014/03/dungeon-dice/" title="Next post: Dungeon World Dice Probabilities">Dungeon World Dice Probabil... <i class="fas fa-angle-right"></i></a></div></nav><div class="container bottombot"><i class="fas fa-robot"></i></div><div class="none"><a href="https://hachyderm.io/@TimidRobot" rel="me">Mastodon</a></div></body></html>